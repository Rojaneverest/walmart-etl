// Walmart ETL Project - Database Schema
// Three-layer data warehouse architecture: ODS, Staging, Target

// ODS Layer Tables
Table ods_customer {
  customer_id varchar [pk]
  customer_name varchar
  customer_age varchar
  customer_segment varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_product {
  product_id varchar [pk]
  product_name varchar
  category varchar
  subcategory varchar
  department varchar
  brand varchar
  price decimal
  cost decimal
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_store {
  store_id varchar [pk]
  store_name varchar
  location varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_supplier {
  supplier_id varchar [pk]
  supplier_name varchar
  contact_person varchar
  email varchar
  phone varchar
  address varchar
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_date {
  full_date date [pk]
  day_of_week varchar
  day_name varchar
  month integer
  month_name varchar
  quarter integer
  year integer
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_return_reason {
  reason_code varchar [pk]
  reason_description varchar
  category varchar
  impact_level varchar
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_sales {
  sale_id varchar [pk]
  order_id varchar
  order_date date
  customer_id varchar
  product_id varchar
  store_id varchar
  quantity_sold integer
  unit_price decimal
  sales_amount decimal
  discount_amount decimal
  order_priority varchar
  ship_date date
  ship_mode varchar
  shipping_cost decimal
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_inventory {
  inventory_id varchar [pk]
  date date
  product_id varchar
  store_id varchar
  stock_level integer
  etl_batch_id varchar
  etl_created_date timestamp
}

Table ods_returns {
  return_id varchar [pk]
  return_date date
  product_id varchar
  store_id varchar
  reason_code varchar
  quantity_returned integer
  return_amount decimal
  original_sale_id varchar
  etl_batch_id varchar
  etl_created_date timestamp
}

// Staging Layer Tables
Table stg_customer {
  customer_id varchar [pk]
  customer_name varchar
  customer_age varchar
  customer_segment varchar
  email varchar
  phone varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  country varchar
  customer_since date
  customer_type varchar
  loyalty_segment varchar
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_product {
  product_id varchar [pk]
  product_name varchar
  category varchar
  subcategory varchar
  department varchar
  brand varchar
  price decimal
  cost decimal
  supplier_key integer
  is_active boolean
  introduction_date date
  discontinuation_date date
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_store {
  store_id varchar [pk]
  store_name varchar
  store_type varchar
  location varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  country varchar
  store_size_sqft integer
  opening_date date
  remodeling_date date
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_supplier {
  supplier_id varchar [pk]
  supplier_name varchar
  contact_person varchar
  email varchar
  phone varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  country varchar
  contract_start_date date
  contract_end_date date
  supplier_rating integer
  supplier_status varchar
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_date {
  full_date date [pk]
  day_of_week varchar
  day_name varchar
  day_of_month integer
  day_of_year integer
  week_of_year integer
  month integer
  month_name varchar
  quarter integer
  year integer
  is_weekend boolean
  is_holiday boolean
  holiday_name varchar
  fiscal_year integer
  fiscal_quarter integer
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_return_reason {
  reason_code varchar [pk]
  reason_description varchar
  category varchar
  impact_level varchar
  is_controllable boolean
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_sales {
  sale_id varchar [pk]
  order_id varchar
  order_date date
  customer_id varchar
  product_id varchar
  store_id varchar
  sales_amount decimal
  quantity_sold integer
  unit_price decimal
  total_cost decimal
  profit_margin decimal
  discount_amount decimal
  net_sales_amount decimal
  sales_channel varchar
  promotion_key integer
  order_priority varchar
  ship_date date
  ship_mode varchar
  shipping_cost decimal
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_inventory {
  inventory_id varchar [pk]
  date date
  product_id varchar
  store_id varchar
  stock_level integer
  min_stock_level integer
  max_stock_level integer
  reorder_point integer
  last_restock_date date
  days_of_supply integer
  stock_status varchar
  is_in_stock boolean
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

Table stg_returns {
  return_id varchar [pk]
  return_date date
  product_id varchar
  store_id varchar
  reason_code varchar
  return_amount decimal
  quantity_returned integer
  original_sale_id varchar
  original_sale_date date
  return_condition varchar
  days_since_purchase integer
  refund_type varchar
  etl_batch_id varchar
  etl_created_date timestamp
  etl_processed boolean
}

// Target Layer Tables - Dimensional Model
Table tgt_dim_date {
  date_key integer [pk]
  full_date date [not null]
  day_of_week varchar
  day_name varchar
  day_of_month integer
  day_of_year integer
  week_of_year integer
  month integer
  month_name varchar
  quarter integer
  year integer
  is_weekend boolean
  is_holiday boolean
  holiday_name varchar
  fiscal_year integer
  fiscal_quarter integer
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

Table tgt_dim_customer {
  customer_key integer [pk, increment]
  customer_id varchar [unique, not null]
  customer_name varchar
  customer_age varchar
  customer_segment varchar
  email varchar
  phone varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  country varchar
  customer_since date
  customer_type varchar
  loyalty_segment varchar
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

Table tgt_dim_supplier {
  supplier_key integer [pk, increment]
  supplier_id varchar [unique, not null]
  supplier_name varchar
  contact_person varchar
  email varchar
  phone varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  country varchar
  contract_start_date date
  contract_end_date date
  supplier_rating integer
  supplier_status varchar
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

Table tgt_dim_return_reason {
  return_reason_key integer [pk, increment]
  reason_code varchar [unique, not null]
  reason_description varchar
  category varchar
  impact_level varchar
  is_controllable boolean
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

// SCD Type 2 implementation
Table tgt_dim_product {
  product_key integer [pk, increment]
  product_id varchar [not null]
  product_name varchar
  category varchar
  subcategory varchar
  department varchar
  brand varchar
  price decimal
  cost decimal
  supplier_key integer [ref: > tgt_dim_supplier.supplier_key]
  is_active boolean
  introduction_date date
  discontinuation_date date
  effective_date date [not null]
  expiry_date date
  current_indicator boolean
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

// SCD Type 2 implementation
Table tgt_dim_store {
  store_key integer [pk, increment]
  store_id varchar [not null]
  store_name varchar
  store_type varchar
  location varchar
  address varchar
  city varchar
  state varchar
  zip_code varchar
  region varchar
  country varchar
  store_size_sqft integer
  opening_date date
  remodeling_date date
  effective_date date [not null]
  expiry_date date
  current_indicator boolean
  dw_created_date timestamp
  dw_modified_date timestamp
  dw_version_number integer
}

Table tgt_fact_sales {
  sale_key integer [pk, increment]
  sale_id varchar [unique, not null]
  order_id varchar
  date_key integer [not null, ref: > tgt_dim_date.date_key]
  product_key integer [not null, ref: > tgt_dim_product.product_key]
  store_key integer [not null, ref: > tgt_dim_store.store_key]
  customer_key integer [not null, ref: > tgt_dim_customer.customer_key]
  sales_amount decimal [not null]
  quantity_sold integer [not null]
  unit_price decimal
  total_cost decimal
  profit_margin decimal
  discount_amount decimal
  net_sales_amount decimal
  sales_channel varchar
  promotion_key integer
  order_priority varchar
  ship_date_key integer [ref: > tgt_dim_date.date_key]
  ship_mode varchar
  shipping_cost decimal
  dw_created_date timestamp
  dw_modified_date timestamp
}

Table tgt_fact_inventory {
  inventory_key integer [pk, increment]
  inventory_id varchar [unique, not null]
  date_key integer [not null, ref: > tgt_dim_date.date_key]
  product_key integer [not null, ref: > tgt_dim_product.product_key]
  store_key integer [not null, ref: > tgt_dim_store.store_key]
  stock_level integer [not null]
  min_stock_level integer
  max_stock_level integer
  reorder_point integer
  last_restock_date_key integer [ref: > tgt_dim_date.date_key]
  days_of_supply integer
  stock_status varchar
  is_in_stock boolean
  dw_created_date timestamp
  dw_modified_date timestamp
}

Table tgt_fact_returns {
  return_key integer [pk, increment]
  return_id varchar [unique, not null]
  date_key integer [not null, ref: > tgt_dim_date.date_key]
  product_key integer [not null, ref: > tgt_dim_product.product_key]
  store_key integer [not null, ref: > tgt_dim_store.store_key]
  return_reason_key integer [not null, ref: > tgt_dim_return_reason.return_reason_key]
  return_amount decimal [not null]
  quantity_returned integer [not null]
  original_sale_id varchar
  original_sale_date_key integer [ref: > tgt_dim_date.date_key]
  return_condition varchar
  days_since_purchase integer
  refund_type varchar
  dw_created_date timestamp
  dw_modified_date timestamp
}

// ETL tracking table
Table etl_run_log {
  log_id integer [pk, increment]
  dag_id varchar
  task_id varchar
  batch_id varchar
  status varchar
  message text
  created_at timestamp
}

// Airflow connection tracking
Table airflow_connection_tracking {
  id integer [pk, increment]
  connection_id varchar
  connection_type varchar
  last_used timestamp
  created_at timestamp
}